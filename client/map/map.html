<template name="main_map">
  {{> map_wrapper}}
  <div class="ui-layout-west" id="childLayout_west">
    {{> map_info}}
  </div>
</template>

<body>
  {{> map_editForm}}
</body>
<template name="map_wrapper">
  <div class="ui-layout-center" id="map_wrapper">
    <div id="point_pos" style="left: 0; top: 0;">
      指標位置：(<span class="x">?</span>,<span class="y">?</span>)
    </div>
    {{> map_table}}
  </div>
</template>

<template name="map_editForm">
  <form action="javascript:" id="map_editForm" class="modal hide fade form-horizontal">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h4>地圖物件編輯器</h4>
    </div>
    <div class="modal-body">
      {{#each editing}}
        <div class="editing">
          {{type}}
        </div>
      {{/each}}
    </div>
  </form>
</template>

<template name="map_info">
  <form action="javascript:" class="form-inline" id="map_info">
    <div>
      {{#isolate}}
        {{#if prevRound}}
          <a href="/map/{{roomID}}/{{mapID}}/{{prevRound}}/" class="pull-left">上一輪</a>
        {{/if}}
        當前回合：{{nowRound}}
        {{#if vextRound}}
          <a href="/map/{{roomID}}/{{mapID}}/{{nextRound}}/" class="pull-right">下一輪</a>
        {{/if}}
      {{/isolate}}
    </div>
    <section>
      <header>
        檢視設定
      </header>
      <div class="content" style="display:none;">
        <p class="grid_size">
          地圖方格大小：
          <input type="number" class="number grid_size" name="grid_size" min="20" step="1" />
        </p>
        <p class="unit_size">
          單位標誌大小：
          <input type="number" class="number unit_size" name="unit_size" min="20" step="1" />
        </p>
        <p class="change_view">
          切換視角：
          <select class="change_view"></select>
        </p>
      </div>
    </section>
    {{#isolate}}
      <section>
        <header>
          效應資訊
          {{#if isAdm}}
            <a href="javascript:" class="pull-right" data-fn="add" data-type="affect" title="新增效應">新增</a>
            <a href="javascript:" class="pull-right" data-fn="editAll" data-type="affect" title="編輯全部效應">編輯全部</a>
            <a href="javascript:" class="pull-right" data-fn="edit" data-type="affect" title="編輯已展開的效應">編輯所選</a>
          {{/if}}
        </header>
        <div class="content" style="display:none;">
          {{#if hasAffect}}
            {{#each allAffect}}
              {{#isolate}}
                <section data-id="{{_id}}">
                  <header>
                    {{name}}
                  </header>
                  <div class="content" style="display:none;">
                    效應中止回合：{{round}}
                    <br />
                    {{{showDesc}}}
                    {{#if isAdm}}
                      <br />
                      {{{hideDesc}}}
                    {{/if}}
                  </div>
                </section>
              {{/isolate}}
            {{/each}}
          {{else}}
            目前沒有任何資料！
          {{/if}}
        </div>
      </section>
    {{/isolate}}
    {{#isolate}}
      <section>
        <header>
          地型資訊
          {{#if isAdm}}
            <a href="javascript:" class="pull-right" data-fn="add" data-type="land" title="新增地型">新增</a>
            <a href="javascript:" class="pull-right" data-fn="editAll" data-type="land" title="編輯全部地型">編輯全部</a>
            <a href="javascript:" class="pull-right" data-fn="edit" data-type="land" title="編輯已展開的地型">編輯所選</a>
          {{/if}}
        </header>
        <div class="content" style="display:none;">
          {{#if hasAffect}}
            {{#each allAffect}}
              {{#isolate}}
                <section data-id="{{_id}}">
                  <header>
                    {{name}}
                  </header>
                  <div class="content" style="display:none;">
                  </div>
                </section>
              {{/isolate}}
            {{/each}}
          {{else}}
            目前沒有任何資料！
          {{/if}}
        </div>
      </section>
    {{/isolate}}
    {{#isolate}}
      <section>
        <header>
          單位資訊
          {{#if isAdm}}
            <a href="javascript:" class="pull-right" data-fn="add" data-type="unit" title="新增單位">新增</a>
            <a href="javascript:" class="pull-right" data-fn="editAll" data-type="unit" title="編輯全部單位">編輯全部</a>
            <a href="javascript:" class="pull-right" data-fn="edit" data-type="unit" title="編輯已展開的單位">編輯所選</a>
          {{/if}}
        </header>
        <div class="content" style="display:none;">
          {{#if hasAffect}}
            {{#each allAffect}}
              {{#isolate}}
                <section data-id="{{_id}}">
                  <header>
                    {{name}}
                  </header>
                  <div class="content" style="display:none;">
                  </div>
                </section>
              {{/isolate}}
            {{/each}}
          {{else}}
            目前沒有任何資料！
          {{/if}}
        </div>
      </section>
    {{/isolate}}
  </form>
</template>

<template name="map_table">
{{#if loaded}}
  <table id="map_table">
    <thead>
      <th>Y\X</th>
      {{#each sizeX}}
        <th>{{this}}</th>
      {{/each}}
      <th>X/Y</th>
    </thead>
    <tbody>
      {{#each sizeY}}
        <tr>
          <th>{{this}}</th>
          {{#each GridsRow this}}
            {{#isolate}}
              <td data-x="{{x}}" data-y="{{y}}" data-pos="{{x}},{{x}}">{{x}},{{y}}</td>
            {{/isolate}}
          {{/each}}
          <th>{{this}}</th>
        </tr>
      {{/each}}
    </tbody>
    <tfoot>
      <th>Y/X</th>
      {{#each sizeX}}
        <th>{{this}}</th>
      {{/each}}
      <th>X\Y</th>
    </tfoot>
  </table>
{{/if}}
</template>