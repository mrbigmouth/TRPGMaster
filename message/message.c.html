<template name="message">
  {{> message_filter}}
  <div id="message_listWrapper">
    {{> message_list}}
  </div>
  {{> message_chat}}
  <i class="fa fa-caret-square-o-down openFilter" title="篩選訊息"></i>
  <i class="fa fa-caret-square-o-up closeFilter" title="關閉篩選列"></i>
  <i class="fa fa-caret-square-o-up openChat" title="開啟發言欄"></i>
  <i class="fa fa-caret-square-o-down closeChat" title="關閉發言欄"></i>
</template>

<template name="message_filter">
  <form action="javascript:" id="message_filter" class="form-inline">
    <label>
      <strong>選擇房間：</strong>
      <select class="form-control" name="room">
        <option value="">全部房間</option>
        {{#each allRooms}}
          <option value="{{_id}}">{{name}}</option>
        {{/each}}
      </select>
    </label>
    <label class="checkbox-inline">
      <input type="checkbox" class="type" name="chat" checked="checked" /> 聊天
    </label>
    <label class="checkbox-inline">
      <input type="checkbox" class="type" name="dice" checked="checked" /> 擲骰
    </label>
    <label class="checkbox-inline">
      <input type="checkbox" class="type" name="outside" checked="checked" /> 場外
    </label>
    <label class="checkbox-inline">
      <input type="checkbox" class="type" name="room" checked="checked" /> 團務
    </label>
    <label class="checkbox-inline">
      <input type="checkbox" class="type" name="system" checked="checked" /> 系統
    </label>
  </form>
</template>

<template name="message_list">
  <ul id="message_list">
    {{#each allMsgs}}
      <li>
        <span>{{timeChinese this.time}}</span>
        <span class="badge badge-success">{{roomName this.room}}</span>
        <span class="badge">{{typeChinese this.type}}</span>
        {{#if typeChat}}
          <span>{{getNick this.user}}：</span>
          <span>{{this.msg}}</span>
        {{/if}}
        {{#if typeSystem}}
          <span>{{getNick this.user}}</span>
          <span>{{this.msg}}</span>
        {{/if}}
        {{#if typeDice}}
          {{#if this.result}}
            {{#if this.isHide}}
              <span class="badge badge-inverse">暗骰</span>
            {{/if}}
            <span>{{getNick user}}為{{this.who}}擲了一次{{this.name}}骰{{#if this.note}}（{{this.note}}）{{/if}} {{diceResult}}</span>
          {{else}}
            <span>擲骰結果載入中...</span>
          {{/if}}
        {{/if}}
        {{#if isRecord}}
          <span>　</span>
          <a href="/room/{{this.room}}/{{this.chapter}}/#{{this.section}}">前往</a>
        {{/if}}
        {{#if isDocument}}
          <span>　</span>
          <a href="/room/{{this.room}}/document/#{{this.document}}">前往</a>
        {{/if}}
        {{#if isCharacter}}
          <span>　</span>
          <a href="/room/{{this.room}}/character/{{this.character}}/">前往</a>
        {{/if}}
      </li>
    {{/each}}
  </ul>
</template>

<template name="message_chat">
  <form action="javascript:" id="message_chat" class="form-inline">
    <label for="message_chat_send">
        聊天：
      <input type="text" class="form-control" id="message_chat_send" name="message_chat_send" />
      <button type="submit" class="btn btn-primary">送出</button>
    </label>
  </form>
</template>